<app-header></app-header>
<div class="profile-container" dir="rtl">
  <h2>پروفایل کاربر</h2>
  @if (isLoading()) {
    <div class="loading">در حال لود...</div>
  }
  @if (errorMessage()) {
    <div class="error-message">{{ errorMessage() }}</div>
  }
  @if (successMessage()) {
    <div class="success-message">{{ successMessage() }}</div>
  }
  @if (userProfile()) {
    @if (!isEditing()) {
      <div class="profile-details">
        <p><strong>نام کامل:</strong> {{ userProfile()?.fullName || 'ندارد' }}</p>
        <p><strong>ایمیل:</strong> {{ userProfile()?.email }}</p>
        <p><strong>شماره تماس:</strong> {{ userProfile()?.phone || 'ندارد' }}</p>
        <button type="button" (click)="toggleEdit()">ویرایش</button>
      </div>
    } @else {
      <form [formGroup]="profileForm" (ngSubmit)="saveProfile()">
        <div class="form-group">
          <label for="fullName">نام کامل</label>
          <input id="fullName" formControlName="fullName" type="text" />
        </div>
        <div class="form-group">
          <label for="email">ایمیل *</label>
          <input id="email" formControlName="email" type="email" (blur)="checkEmail()" />
          @if (emailError()) {
            <div class="error">{{ emailError() }}</div>
          }
        </div>
        <div class="form-group">
          <label for="phone">شماره تماس</label>
          <input id="phone" formControlName="phone" type="tel" (blur)="checkPhone()" />
          @if (phoneError()) {
            <div class="error">{{ phoneError() }}</div>
          }
        </div>
        <div class="form-group">
          <label for="newPassword">رمز عبور جدید</label>
          <input id="newPassword" formControlName="newPassword" type="password" (blur)="checkPassword()" />
        </div>
        <div class="form-group">
          <label for="confirmPassword">تأیید رمز عبور</label>
          <input id="confirmPassword" formControlName="confirmPassword" type="password" (blur)="checkPassword()" />
          @if (passwordError()) {
            <div class="error">{{ passwordError() }}</div>
          }
        </div>
        <button type="submit" [disabled]="isLoading()">ذخیره</button>
        <button type="button" (click)="toggleEdit()" [disabled]="isLoading()">لغو</button>
      </form>
    }
    <button type="button" (click)="logout()" [disabled]="isLoading()">خروج</button>
  } @else {
    <p>پروفایل یافت نشد. لطفاً لاگین کنید.</p>
  }
</div>